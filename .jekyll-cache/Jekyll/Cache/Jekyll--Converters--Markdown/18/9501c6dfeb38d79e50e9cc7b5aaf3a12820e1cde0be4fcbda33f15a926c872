I"Ï<p><img src="https://miro.medium.com/max/700/1*rG6GnMOz0nlRUUU1Va7aTA.jpeg" alt="Container House" /></p>

<p><a href="https://medium.com/@jrperin1975/docker-accessing-host-database-49e1ff92a40"><strong>Acesse meu Medium e veja vers√£o em Ingl√™s</strong></a></p>

<hr />

<h2 id="introdu√ß√£o">Introdu√ß√£o</h2>

<p>Atualmente ao desenvolver uma aplica√ß√£o, <strong>√© imposs√≠vel</strong> n√£o pensar em embarc√°-la em um <strong>cont√™iner</strong>.</p>

<p>A conteineriza√ß√£o das nossas aplica√ß√µes traz ganhos como padroniza√ß√£o, portabilidade, automatiza√ß√£o que facilitam em muito o deploy.
Mas uma quest√£o sempre fica rondando, at√© onde devemos levar para cont√™ineres?</p>

<p>Na minha opini√£o estruturas de bancos de dados como Mysql, Mariadb, MongoDb quando em produ√ß√£o, deveriam ter recursos mais dedicados a eles, mais ‚Äúbare metal‚Äù. Aqui n√£o estou considerando recursos de bancos de dados gerenciados pelos provedores de cloud como AWS, Google, Azure. Estou considerando que a gest√£o dos recursos dos bancos de dados √© feita por voc√™.</p>

<p>Claro que se estivermos falando em ambiente de desenvolvimento, o cen√°rio √© outro.</p>

<p>Colocar os recursos de banco de dados em cont√™ineres, facilita muito para o desenvolvedor ter um um ambiente rodando. Sem que ele tenha que se preocupar com a infraestrutura.</p>

<p>Para que um uma aplica√ß√£o docker possa acessar o ‚Äúmundo externo‚Äù √© preciso informar para ela o IP do host (do hospedeiro).</p>

<p>No <code class="language-plaintext highlighter-rouge">docker-compose</code> isso √© feito pelo membro <code class="language-plaintext highlighter-rouge">extra_hosts</code> ou via linha de comando com o par√¢metro <code class="language-plaintext highlighter-rouge">--add-hosts</code>, que adiciona o endere√ßo ao DNS interno do Docker.</p>

<p>Nesse <em>case</em>, vou focar no <strong>docker-compose</strong>.</p>

<p><strong>Resumo dos passos que ser√£o dados:</strong></p>

<ol>
  <li>
    <p>Instalar o banco de dados Mariadb em um computador com Ubuntu que ser√° a m√°quina hospedeira.</p>
  </li>
  <li>
    <p>Criar um cont√™iner com ferramentas para acessar o banco de dados Mariadb do hospedeiro (Dockerfile e docker-compose.yml).</p>
  </li>
  <li>
    <p>Alterar as permiss√µes do usu√°rio root do banco de dados para permitir acesso do <strong>IP docker</strong> atribu√≠do ao host.</p>
  </li>
  <li>
    <p>Alterar o <strong>bind-address</strong> do banco de dados para permitir acesso atrav√©s do <strong>IP docker do host</strong>.</p>
  </li>
  <li>
    <p>Validar, fazendo o teste de conex√£o do cont√™iner para o host.</p>
  </li>
</ol>

<h2 id="execu√ß√£o">Execu√ß√£o</h2>

<h3 id="1-instalar-mariadb-no-hospedeiro">1. Instalar MariaDB no hospedeiro</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> mariadb-server
</code></pre></div></div>

<h3 id="2-criar-cont√™iner-para-acessar-o-db-no-host">2. Criar cont√™iner para acessar o DB no host</h3>

<p>Criar o arquivo <strong>Dockerfile</strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM ubuntu
RUN apt update <span class="o">&amp;&amp;</span> apt <span class="nb">install</span> <span class="nt">-y</span> iputils-ping net-tools telnet vim mysql-client
</code></pre></div></div>

<p>Criar o arquivo <strong>docker-compose.yml:</strong></p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.9"</span>
<span class="na">services</span><span class="pi">:</span>
    <span class="na">ubuntu</span><span class="pi">:</span>
        <span class="na">build</span><span class="pi">:</span>
            <span class="na">context</span><span class="pi">:</span> <span class="s">./</span>
            <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile</span>
    <span class="na">extra_hosts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">database:172.17.0.1"</span>
</code></pre></div></div>
:ET